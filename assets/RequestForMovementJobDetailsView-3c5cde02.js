import{r as u,d as L,i as $,q as b,a as H,j as K,w as g,T as Q,o as m,c as h,b as s,t as T,e as p,u as n,k as y,g as k,n as C}from"./index-675e3599.js";import{s as W}from"./scrollHelper-62f64ba1.js";import{u as X}from"./useRequestsForMovementJobs-d1e226bd.js";import{u as Y}from"./useFormValidation-6eda1048.js";import{_ as U,N as F}from"./NoOptionsComponent-06eee6fc.js";import{g as A,b as M}from"./api-6055b01b.js";import{C as Z,p as N}from"./paginationHelper-8171a740.js";import{u as ee}from"./useUnits-3f386980.js";const te={id_tipo_documento:{rules:[{validation:t=>t&&t>0,message:"El tipo de documento es requerido."}]},justificacion_solicitud:{rules:[{validation:t=>t&&t.length>0,message:"La justificación de la solicitud es requerida."}]}},oe={id_unidad_administrativa_generadora:null,id_tipo_documento:null,justificacion_solicitud:"",fecha_solicitud:""},R="cat_tipo_documento/",ae=()=>{const t=u({...Z});return{documentTypes:t,getAllDocumentTypes:async({page:r=1,pageSize:d=t.value.pagination.page_size,loader:v=!0})=>{try{t.value.loading=!0;const o=await A(`${R}`,{page:r,page_size:d,paginate:!1},v);return t.value.data=o,t.value.pagination=N(t.value.pagination,r,o.count),t.value.loading=!1,Promise.resolve(o.results)}catch(o){return console.error(o),console.log("Error al cargar unidades",o),Promise.reject(o)}},searchDocumentTypes:async(r="",d=1,v=!1)=>{try{t.value.loading=!0;const o=await A(`${R}`,{page:d,search:r,page_size:t.value.pagination.page_size},v);return t.value.data=o.results,t.value.pagination=N(t.value.pagination,d,o.count),t.value.loading=!1,Promise.resolve(o.results)}catch(o){return console.error(o),console.log("Error al cargar puestos",o),Promise.reject(o)}}}},se={key:0},ie={class:"view-name"},le=s("hr",{class:"red"},null,-1),ne={class:"p-4"},ue={class:"form-group"},ce=s("label",null,"Unidad Administrativa Generadora",-1),re={key:0,class:"form-text text-muted app-validation"},de={class:"form-group"},me=s("label",{for:"nombre-operacion"},"Fecha solicitud",-1),pe={class:"form-group"},ve=s("label",null,"Tipo de documento",-1),_e={key:0,class:"form-text text-muted app-validation"},fe={class:"form-group"},ge=s("label",null,"Justificación de solicitud",-1),he={key:0,class:"form-text text-muted app-validation"},ye={key:0,class:"form-text text-muted app-form-message"},qe=L({__name:"RequestForMovementJobDetailsView",setup(t){const V=u("Registrar solicitud de movimiento de plaza"),{saveRequestForMovementJobs:q,updateRequestForMovementJobs:r,getRequestForMovementJobsById:d}=X(),{searchDocumentTypes:v,getAllDocumentTypes:o}=ae(),{searchUnits:J,getAllUnits:O}=ee(),_=u(""),S=u(!1),f=u(!1),a=u({...oe}),w=u([]),D=u(!1),j=u([]),x=u(!1),{isValid:E,errors:c}=Y(a.value,te),I=()=>{b.push({name:"solicitudes-de-movimiento-de-plazas"})},B=()=>{E.value&&(_.value?r(_.value,{...a.value}).then(()=>{b.push({name:"solicitudes-de-movimiento-de-plazas"})}).catch(()=>{f.value=!0,setTimeout(()=>{f.value=!1},3e3)}):q({...a.value}).then(l=>{b.push({name:"seleccion-plazas",params:{id:l.id}})}).catch(()=>{f.value=!0,setTimeout(()=>{f.value=!1},3e3)}))},P=M(l=>{l.length>0&&(D.value=!0,v(l,1,!1).then(e=>{w.value=e,D.value=!1}))},350),G=M(l=>{l.length>0&&(x.value=!0,J(l,1,!1).then(e=>{j.value=e,x.value=!1}))},350);return $(async()=>{var l;_.value=(l=b.currentRoute.value.params.id)==null?void 0:l.toString(),_.value?(V.value="Actualizar solicitud de movimiento de plaza",await O({}).then(e=>{j.value=e}),await o({}).then(e=>{w.value=e}),d(_.value).then(e=>{a.value.id_unidad_administrativa_generadora=e.id_unidad_administrativa_generadora,a.value.fecha_solicitud=e.fecha_solicitud,a.value.id_tipo_documento=e.id_tipo_documento,a.value.justificacion_solicitud=e.justificacion_solicitud,S.value=!0})):(S.value=!0,a.value.fecha_solicitud=new Date().toISOString().split("T")[0]),W()}),(l,e)=>{const z=H("v-select");return m(),K(Q,{name:"view"},{default:g(()=>[S.value?(m(),h("div",se,[s("h4",ie,T(V.value),1),le,s("form",ne,[s("div",ue,[ce,p(z,{modelValue:a.value.id_unidad_administrativa_generadora,"onUpdate:modelValue":e[0]||(e[0]=i=>a.value.id_unidad_administrativa_generadora=i),loading:x.value,reduce:i=>i.clave,options:j.value,placeholder:"Selecciona una opción",filterable:!1,onSearch:n(G),label:"nombre",class:"style-v-select form-select form-control"},{spinner:g(({loading:i})=>[p(U,{loading:i},null,8,["loading"])]),"no-options":g(()=>[p(F)]),_:1},8,["modelValue","loading","reduce","options","onSearch"]),n(c)&&n(c).id_unidad_administrativa_generadora?(m(),h("small",re,T(n(c).id_unidad_administrativa_generadora),1)):y("",!0)]),s("div",de,[me,k(s("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=i=>a.value.fecha_solicitud=i),class:"form-control",placeholder:"Introduzca la fecha de solicitud",autocomplete:"off"},null,512),[[C,a.value.fecha_solicitud]])]),s("div",pe,[ve,p(z,{modelValue:a.value.id_tipo_documento,"onUpdate:modelValue":e[2]||(e[2]=i=>a.value.id_tipo_documento=i),loading:D.value,reduce:i=>i.id,options:w.value,placeholder:"Selecciona una opción",filterable:!1,onSearch:n(P),label:"nombre",class:"style-v-select form-select form-control"},{spinner:g(({loading:i})=>[p(U,{loading:i},null,8,["loading"])]),"no-options":g(()=>[p(F)]),_:1},8,["modelValue","loading","reduce","options","onSearch"]),n(c)&&n(c).id_tipo_documento?(m(),h("small",_e,T(n(c).id_tipo_documento),1)):y("",!0)]),s("div",fe,[ge,k(s("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=i=>a.value.justificacion_solicitud=i),class:"form-control",placeholder:"Introduzca la justificación de la solicitud",autocomplete:"off"},null,512),[[C,a.value.justificacion_solicitud]]),n(c)&&n(c).justificacion_solicitud?(m(),h("small",he,T(n(c).justificacion_solicitud),1)):y("",!0)]),s("div",{class:"modal-footer"},[s("button",{type:"button",class:"btn btn-secondary",onClick:I}," Cancelar "),s("button",{type:"button",onClick:B,class:"btn btn-primary"}," Guardar ")]),f.value?(m(),h("small",ye," Verifique que los datos esten correctos, o no haya sido registrado previamiente. ")):y("",!0)])])):y("",!0)]),_:1})}}});export{qe as default};
